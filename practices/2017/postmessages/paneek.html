<!DOCTYPE html>
<html>
<title>HTML Tutorial</title>

<style>
	
	.column {
		width: 49%;
		display: inline-block;
		vertical-align: top;
	}	
</style>

<script
  src="https://code.jquery.com/jquery-2.2.4.min.js"
  integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
  crossorigin="anonymous"></script>

<script>
	var origin = undefined;

	$( document ).ready(function() {

		$('#connetToPaneek').on('click',function(){
			
			var domain = 'https://hidden-escarpment-3694.herokuapp.com';
			var iframe = document.getElementById('myIframe').contentWindow;

			var message = 'Hello!  The time is: ' + (new Date().getTime());
			iframe.postMessage(message,domain); //send the message and target URI		

		});


		window.addEventListener('message',function(event) {
			
			if(event.origin === 'https://hidden-escarpment-3694.herokuapp.com') {
				var paneekEvent = JSON.parse(event.data);
				
				switch(paneekEvent.eventName) {
	            case 'tour:listeningIframe':
	               jQuery('#eventsList').append('<li>' + paneekEvent.eventName + '</li>');				
						jQuery('#tourId').html(paneekEvent.data.id);
						jQuery('#tourPanoramas').html(paneekEvent.data.panoramas.length);

						var countHotspots = 0;
						paneekEvent.data.panoramas.forEach(function(element) {
					    	countHotspots = countHotspots + element.hotspots.length;
						});

						jQuery('#tourHotspots').html(countHotspots);
	              	updatePanoramaList(paneekEvent);
	            break;
	            case 'hotspot:clicked':
	              jQuery('#eventsList').append('<li>hotspot type:' + paneekEvent.data.type + ' -  clicked</li>');	
	            break;

	         }

				
			}				

		},false);
	   
		

	});


	function updatePanoramaList(info) {
		info.data.panoramas.forEach(function(currentPanorama) {
			jQuery('#panoramaList').append('<li>' + currentPanorama.name + '</li>');

			currentPanorama.hotspots.forEach(function(hotspot){
				jQuery('#hotspotsOnPanorama').append('<li>' + hotspot.title +  
					'<button>Done</button> <button>Undone</button>' +
				'</li>');
			});
		});
		
	};

	
</script>

<body>


<h1>Post message: Parent iframe</h1>

<iframe id="myIframe" src="https://hidden-escarpment-3694.herokuapp.com/#/tour/view/100" frameborder="0" style="height: 400px;width:100%;border:1px solid red;"></iframe>

<div class="column">
	<div>
		<button id="connetToPaneek">
			Connect to Panek
		</button>	
	</div>
	
	
	<label>Events</label>
	<ul id="eventsList">	
	</ul>	
</div>

<div class="column"> 
	<h2>Info from Paneek</h2>
	<div>
		<b>Tour id:</b> <span id="tourId"></span>
	</div>
	<div>
		<b>Panoramas on tour:</b> <span id="tourPanoramas"></span>	
	</div>
	<div>
		<b>Hotspots on tour:</b> <span id="tourHotspots"></span>	
	</div>	

	<h4>Panoramas</h4>
	<ul id="panoramaList">
		
	</ul>
	<h4>
		Hotspots on Panorama loaded
	</h4>
	<ul id="hotspotsOnPanorama">
		
	</ul>
</div>


</body>
</html>